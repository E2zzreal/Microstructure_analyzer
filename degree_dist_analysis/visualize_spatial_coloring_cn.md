# `visualize_spatial_coloring.py` 中文文档

## 目的

该脚本生成一张分割后的微观结构图像，其中每个单独的晶粒根据与其关联的特定特征的值（例如其邻居数量、面积、方向、长宽比）进行着色。

这种类型的可视化对于识别微观结构中与所选特征相关的空间模式、聚类或梯度非常有用。

## 先决条件

*   包含样本分割结果的 `.mask` 文件。
*   包含每个晶粒特征（包括用于着色的特征）的相应 `_details.csv` 文件。此文件由 `run_feature_extraction.py` 使用 `--save_grain_details` 标志生成。

## 使用方法

```bash
python visualize_spatial_coloring.py --mask_path <掩码文件路径> \
                                     --details_csv <详细数据文件路径> \
                                     --output_path <输出图像保存路径.png> \
                                     [--color_feature <颜色特征名称>] \
                                     [--cmap <颜色映射名称>]
```

## 参数说明

*   `--mask_path` (必需): 输入样本的 `.mask` 文件路径。
*   `--details_csv` (必需): 包含每个晶粒特征的相应 `_details.csv` 文件路径。
*   `--output_path` (必需): 输出可视化图像（例如 `.png`）的保存路径。
*   `--color_feature` (可选): `_details.csv` 文件中用于给晶粒着色的列名。默认值：`'neighbor_count'` (邻居数量)。
*   `--cmap` (可选): 用于着色的 Matplotlib 颜色映射 (colormap) 名称。默认值：`'viridis'`。

## 输出

*   一个图像文件（例如 `.png`），保存在指定的 `--output_path`。该图像显示了分割后的晶粒，每个晶粒根据其在指定 `--color_feature` 上的值进行着色。图中包含一个颜色条，用于指示颜色和特征值之间的映射关系。背景（非晶粒区域）通常显示为白色或其他中性色。

## 解读与材料学意义

*   **空间聚类**: 寻找具有相似特征值（例如，高 `neighbor_count`、大 `area`、特定 `orientation`）的晶粒聚集的区域。微观结构在此特征方面是否表现出异质性？
*   **梯度**: 观察样本中特征值是否存在梯度（例如，靠近一个边缘的晶粒较小，靠近另一个边缘的晶粒较大）。
*   **与位置的相关性**: 具有特定特征值的晶粒是否优先位于某些微观结构元素附近（例如，样品边缘、大孔隙、特定相，如果可识别）？
*   **各向异性**: 如果按 `orientation` 着色，可视化是否揭示了材料内部的择优取向或织构？
*   **比较**: 对同一样本使用不同特征生成这些图，观察空间模式如何关联。比较不同样本（例如，高/低 Hc20）的相同特征图，以识别空间组织上的系统性差异。

这种可视化提供了定量晶粒特征的直接空间映射，有助于弥合统计特征值与材料内部实际物理排列之间的差距。
