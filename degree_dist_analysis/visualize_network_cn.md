# `visualize_network.py` 中文文档

## 目的

该脚本用于可视化单个样本的晶粒连通性网络。它读取分割掩码数据和相应的每个晶粒的特征详细信息，构建一个网络图（通常基于质心的 Delaunay 三角剖分，并按距离过滤），然后将此网络叠加在原始 SEM 图像（如果提供）或分割后的晶粒边界上。网络中的节点代表单个晶粒，可以根据为每个晶粒提取的特定特征（如邻居数量、面积等）进行着色和调整大小。

这种可视化有助于理解微观结构中晶粒的空间排列和连通性模式。

## 先决条件

*   包含样本分割结果的 `.mask` 文件。
*   包含每个晶粒特征（包括质心以及用于着色/调整大小的特征）的相应 `_details.csv` 文件。此文件由 `run_feature_extraction.py` 使用 `--save_grain_details` 标志生成。

## 使用方法

```bash
python visualize_network.py --mask_path <掩码文件路径> \
                            --details_csv <详细数据文件路径> \
                            --output_path <输出图像保存路径.png> \
                            [--image_path <原始tif图像路径>] \
                            [--distance_threshold <距离阈值>] \
                            [--color_feature <颜色特征名称>] \
                            [--size_feature <尺寸特征名称>] \
                            [--min_size <最小尺寸>] \
                            [--max_size <最大尺寸>] \
                            [--cmap <颜色映射名称>]
```

## 参数说明

*   `--mask_path` (必需): 输入样本的 `.mask` 文件路径。
*   `--details_csv` (必需): 包含每个晶粒特征的相应 `_details.csv` 文件路径。
*   `--output_path` (必需): 输出可视化图像（例如 `.png`）的保存路径。
*   `--image_path` (可选): 原始图像文件（例如 `.tif`）的路径。如果提供，网络将叠加在此图像上。否则，将叠加在分割后的晶粒边界上。
*   `--distance_threshold` (可选): 在 Delaunay 图中，两个晶粒质心之间被视为连接的最大距离（像素）。默认值：`50`。调整此值可以揭示不同空间尺度下的连通性。
*   `--color_feature` (可选): `_details.csv` 文件中用于给节点（晶粒）着色的列名。默认值：`'neighbor_count'` (邻居数量)。
*   `--size_feature` (可选): `_details.csv` 文件中用于调整节点（晶粒）大小的列名。默认值：`'area'` (面积)。节点大小将在 `--min_size` 和 `--max_size` 之间线性缩放。
*   `--min_size` (可选): 图中节点的最小尺寸。默认值：`10`。
*   `--max_size` (可选): 图中节点的最大尺寸。默认值：`500`。
*   `--cmap` (可选): 用于节点着色的 Matplotlib 颜色映射 (colormap) 名称。默认值：`'viridis'`。

## 输出

*   一个图像文件（例如 `.png`），保存在指定的 `--output_path`。该图像显示了晶粒网络：
    *   **背景**: 原始 SEM 图像或分割后的晶粒边界。
    *   **节点**: 代表晶粒质心。其颜色和大小分别由 `--color_feature` 和 `--size_feature` 参数确定。
    *   **边**: 代表相邻晶粒之间的连接（基于 Delaunay 图和距离阈值）。

## 解读与材料学意义

*   **连通性**: 观察边的整体密度和模式。晶粒是高度互连的，还是存在孤立区域？
*   **节点着色 (例如，按 `neighbor_count`)**: 识别具有高或低局部连通性的区域。高度数晶粒是否聚集在一起？连通性与晶粒位置（例如，靠近样品边缘）有何关系？
*   **节点大小 (例如，按 `area`)**: 直观评估晶粒尺寸和连通性之间的关系。大晶粒是否倾向于拥有较少的邻居？
*   **比较**: 为具有不同性能（例如，高/低 Hc20）的样本生成这些图。比较它们的网络结构。性能更好的样本是否表现出更均匀的网络、特定的聚类模式，或者尺寸、形状和连通性之间存在不同的关系？
*   **与缺陷的关联**: 如果叠加在原始图像上，将网络特征（如低度数节点或断开的连接）与可见的缺陷或相界关联起来。

通过分析这些网络可视化图，您可以深入了解晶粒的拓扑排列（超越简单的平均尺寸或形状）如何可能影响材料性能。
