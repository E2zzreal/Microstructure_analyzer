# `visualize_degree_outliers.py` 中文文档

## 目的

该脚本生成一张分割后的微观结构图像，并特别高亮显示那些度数（基于选定特征的邻居数量）落在指定范围之外的晶粒。这有助于快速识别具有异常高或低连通性的晶粒。

## 先决条件

*   包含样本分割结果的 `.mask` 文件。
*   包含每个晶粒特征（包括待分析的度特征列）的相应 `_details.csv` 文件。此文件由 `run_feature_extraction.py` 使用 `--save_grain_details` 标志生成。

## 使用方法

```bash
python visualize_degree_outliers.py --mask_path <掩码文件路径> \
                                    --details_csv <详细数据文件路径> \
                                    --output_path <输出图像保存路径.png> \
                                    [--degree_column <度特征列名>] \
                                    [--min_degree <下界>] \
                                    [--max_degree <上界>]
```
**注意：** 必须提供 `--min_degree` 或 `--max_degree` 中的至少一个。

## 参数说明

*   `--mask_path` (必需): 输入样本的 `.mask` 文件路径。
*   `--details_csv` (必需): 包含每个晶粒特征的相应 `_details.csv` 文件路径。
*   `--output_path` (必需): 输出可视化图像（例如 `.png`）的保存路径。
*   `--degree_column` (可选): `_details.csv` 文件中包含度数据的列名。默认值：`'neighbor_count'`。
*   `--min_degree` (可选): 整数值。度数**小于**此值的晶粒将被高亮显示为异常值。
*   `--max_degree` (可选): 整数值。度数**大于**此值的晶粒将被高亮显示为异常值。

## 输出

*   一个图像文件（例如 `.png`），保存在指定的 `--output_path`。该图像显示了分割后的晶粒：
    *   度数落在指定范围之外（`< min_degree` 或 `> max_degree`）的晶粒以独特的颜色（默认：红色）显示。
    *   度数在指定范围内的晶粒（或者如果只提供了一个边界，则那些不满足异常条件的晶粒）以中性色（默认：灰色）显示。
    *   背景通常为白色。
    *   图例指示了异常和正常度数晶粒的颜色。

## 解读与材料学意义

*   **识别极端情况**: 快速定位具有极低连通性（可能孤立或靠近边缘/孔隙）或极高连通性（可能位于密集堆积的簇中，或者如果分割不完美则可能代表伪影）的晶粒。
*   **空间位置**: 观察这些异常晶粒在微观结构中的位置。低度数晶粒是否主要靠近样品边界？高度数晶粒是否聚集在特定区域？
*   **与其他特征的相关性**: 通过将此可视化与 `visualize_spatial_coloring.py` 生成的图（按面积、形状等着色）进行比较，可以研究异常连通性是否与其他晶粒特征相关。
*   **与加工/性能的联系**: 如果在具有特定性能或加工历史的样本中持续观察到某些类型的异常值（例如，大量低度数晶粒），则表明这些极端连通性状态与整体材料行为或形成机制之间存在联系。

这种可视化提供了一个聚焦于表现出异常局部连通性的晶粒的视图，这些晶粒可能是理解结构异质性或失效起始的关键点。
