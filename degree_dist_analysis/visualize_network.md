# `visualize_network.py` Documentation

## Purpose

This script visualizes the grain connectivity network for a single sample. It reads the segmentation mask data and the corresponding per-grain feature details, builds a network graph (typically Delaunay triangulation based on centroids, filtered by distance), and overlays this network onto either the original SEM image (if provided) or the segmented grain boundaries. Nodes in the network represent individual grains and can be colored and sized based on specific features extracted for each grain (like neighbor count, area, etc.).

This visualization helps in understanding the spatial arrangement and connectivity patterns of grains within the microstructure.

## Prerequisites

*   A `.mask` file containing the segmentation results for the sample.
*   A corresponding `_details.csv` file containing per-grain features (including centroids, and the features chosen for coloring/sizing). This file is generated by `run_feature_extraction.py` using the `--save_grain_details` flag.

## Usage

```bash
python visualize_network.py --mask_path <path_to_mask_file> \
                            --details_csv <path_to_details_file> \
                            --output_path <path_to_save_image.png> \
                            [--image_path <path_to_original_tif>] \
                            [--distance_threshold <value>] \
                            [--color_feature <feature_name>] \
                            [--size_feature <feature_name>] \
                            [--min_size <value>] \
                            [--max_size <value>] \
                            [--cmap <colormap_name>]
```

## Arguments

*   `--mask_path` (required): Path to the input `.mask` file for the sample.
*   `--details_csv` (required): Path to the corresponding `_details.csv` file containing per-grain features.
*   `--output_path` (required): Path where the output visualization image (e.g., `.png`) will be saved.
*   `--image_path` (optional): Path to the original image file (e.g., `.tif`). If provided, the network will be overlaid on this image. Otherwise, it will be overlaid on the segmented grain boundaries.
*   `--distance_threshold` (optional): Maximum distance (in pixels) between centroids for two grains to be considered connected in the Delaunay graph. Default: `50`. Adjusting this can reveal connectivity at different spatial scales.
*   `--color_feature` (optional): The name of the column in the `_details.csv` file to use for coloring the nodes (grains). Default: `'neighbor_count'`.
*   `--size_feature` (optional): The name of the column in the `_details.csv` file to use for sizing the nodes (grains). Default: `'area'`. Node sizes are scaled linearly between `--min_size` and `--max_size`.
*   `--min_size` (optional): Minimum node size in the plot. Default: `10`.
*   `--max_size` (optional): Maximum node size in the plot. Default: `500`.
*   `--cmap` (optional): The name of the Matplotlib colormap to use for node coloring. Default: `'viridis'`.

## Output

*   An image file (e.g., `.png`) saved at the specified `--output_path`. This image shows the grain network:
    *   **Background**: Either the original SEM image or the segmented grain boundaries.
    *   **Nodes**: Represent grain centroids. Their color and size are determined by the `--color_feature` and `--size_feature` arguments, respectively.
    *   **Edges**: Represent connections between neighboring grains (based on the Delaunay graph and distance threshold).

## Interpretation & Materials Science Significance

*   **Connectivity**: Observe the overall density and pattern of edges. Are grains highly interconnected, or are there isolated regions?
*   **Node Coloring (e.g., by `neighbor_count`)**: Identify regions with high or low local connectivity. Are high-degree grains clustered together? How does connectivity relate to grain position (e.g., near sample edges)?
*   **Node Sizing (e.g., by `area`)**: Visually assess the relationship between grain size and connectivity. Do large grains tend to have fewer neighbors?
*   **Comparison**: Generate these plots for samples with different properties (e.g., high vs. low Hc20). Compare their network structures. Does the better-performing sample exhibit a more uniform network, specific clustering patterns, or different relationships between size, shape, and connectivity?
*   **Correlation with Defects**: If overlaid on the original image, correlate network features (like low-degree nodes or broken connections) with visible defects or phase boundaries.

By analyzing these network visualizations, you can gain insights into how the topological arrangement of grains, beyond simple average size or shape, might influence material properties.
