# `visualize_spatial_coloring.py` Documentation

## Purpose

This script generates an image of the segmented microstructure where each individual grain is colored based on the value of a specific feature associated with that grain (e.g., its neighbor count, area, orientation, aspect ratio).

This type of visualization is useful for identifying spatial patterns, clusters, or gradients related to the chosen feature within the microstructure.

## Prerequisites

*   A `.mask` file containing the segmentation results for the sample.
*   A corresponding `_details.csv` file containing per-grain features, including the feature selected for coloring. This file is generated by `run_feature_extraction.py` using the `--save_grain_details` flag.

## Usage

```bash
python visualize_spatial_coloring.py --mask_path <path_to_mask_file> \
                                     --details_csv <path_to_details_file> \
                                     --output_path <path_to_save_image.png> \
                                     [--color_feature <feature_name>] \
                                     [--cmap <colormap_name>]
```

## Arguments

*   `--mask_path` (required): Path to the input `.mask` file for the sample.
*   `--details_csv` (required): Path to the corresponding `_details.csv` file containing per-grain features.
*   `--output_path` (required): Path where the output visualization image (e.g., `.png`) will be saved.
*   `--color_feature` (optional): The name of the column in the `_details.csv` file to use for coloring the grains. Default: `'neighbor_count'`.
*   `--cmap` (optional): The name of the Matplotlib colormap to use for coloring. Default: `'viridis'`.

## Output

*   An image file (e.g., `.png`) saved at the specified `--output_path`. The image shows the segmented grains, with each grain colored according to its value for the specified `--color_feature`. A colorbar is included to indicate the mapping between color and feature value. Background (non-grain regions) is typically shown in white or another neutral color.

## Interpretation & Materials Science Significance

*   **Spatial Clustering**: Look for regions where grains with similar feature values (e.g., high `neighbor_count`, large `area`, specific `orientation`) are clustered together. Does the microstructure exhibit heterogeneity in terms of this feature?
*   **Gradients**: Observe if there are gradients in the feature values across the sample (e.g., smaller grains near one edge, larger grains near another).
*   **Correlation with Location**: Are grains with particular feature values preferentially located near certain microstructural elements (e.g., sample edges, large pores, specific phases if identifiable)?
*   **Anisotropy**: If coloring by `orientation`, does the visualization reveal preferred orientations or textures within the material?
*   **Comparison**: Generate these plots for different features on the same sample to see how spatial patterns correlate. Compare plots for the same feature across different samples (e.g., high vs. low Hc20) to identify systematic differences in spatial organization.

This visualization provides a direct spatial mapping of quantitative grain features, helping to bridge the gap between statistical feature values and the actual physical arrangement within the material.
