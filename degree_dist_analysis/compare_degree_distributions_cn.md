# `compare_degree_distributions.py` 中文文档

## 目的

该脚本用于比较多个样本或预定义样本组之间的晶粒度分布。它读取多个样本的每个晶粒的详细信息文件 (`_details.csv`)，提取指定的度特征（例如 `neighbor_count`, `delaunay_degree_adaptive_1r1std`），并生成图表（如 KDE 图、箱线图、小提琴图或分面直方图）以直观地比较这些分布。

这对于识别不同实验条件、材料批次或性能组之间晶粒连通性模式的系统性差异非常有用。

## 先决条件

*   多个 `_details.csv` 文件，每个待比较的样本一个，位于指定的文件夹内。这些文件必须包含用于比较的度特征列。它们由 `run_feature_extraction.py` 使用 `--save_grain_details` 标志生成。

## 使用方法

```bash
python compare_degree_distributions.py --details_folder <包含详细数据文件的文件夹路径> \
                                       --output_path <比较图保存路径.png> \
                                       [--file_pattern <glob模式>] \
                                       [--degree_column <度特征列名>] \
                                       [--plot_type <类型>] \
                                       [--labels <标签1> <标签2> ...]
```

## 参数说明

*   `--details_folder` (必需): 包含待比较样本的 `_details.csv` 文件的目录路径。
*   `--output_path` (必需): 输出比较图图像（例如 `.png`）的保存路径。
*   `--file_pattern` (可选): 用于在 `--details_folder` 中查找相关 `_details.csv` 文件的 glob 模式。默认值：`'*_details.csv'`。
*   `--degree_column` (可选): `_details.csv` 文件中包含要比较的度数据的列名。默认值：`'neighbor_count'`。
*   `--plot_type` (可选): 用于比较的图表类型。可选值：
    *   `'kde'` (默认): 核密度估计图，叠加显示以供比较。适合可视化分布形状和峰值。
    *   `'box'`: 每个样本/组的箱线图，显示中位数、四分位数和潜在异常值。适合比较集中趋势和离散程度。
    *   `'violin'`: 小提琴图，结合了箱线图和 KDE 图的特点。适合同时可视化分布形状和密度。
    *   `'hist'`: 分面直方图，在单独的面板中显示每个样本的分布。适合详细的频率比较。
*   `--labels` (可选): 为找到的每个样本/文件分配的自定义标签列表（按文件被找到的顺序，通常是字母顺序）。如果未提供，则从文件名的开头（第一个下划线之前）自动生成标签。

## 输出

*   一个图像文件（例如 `.png`），保存在指定的 `--output_path`。该图表直观地比较了分析中包含的不同样本之间所选度特征的分布。

## 解读与材料学意义

*   **分布比较 (KDE/Hist)**: 比较样本/组之间分布的形状、峰值位置和宽度。某个组是否始终显示出更高的平均度数？某个组的分布是更宽还是更窄？是否存在多个峰值，表明存在不同的晶粒连通性群体？
*   **集中趋势与离散度 (Box/Violin)**: 比较各组之间的中位度数（箱线图的中线）、四分位距（箱体高度）和整体范围（须）。在典型连通性或连通性变异性方面是否存在显著差异？
*   **统计显著性**: 虽然此脚本提供可视化比较，但观察到的差异可能需要进行正式的统计检验（例如，对按样本分组的度数据进行 t 检验、ANOVA 或 Kruskal-Wallis 检验）以确认其显著性（如果需要）。
*   **与性能/条件的联系**: 将观察到的度分布差异与样本/组相关的已知材料性能（例如 Hc20）或加工条件的差异联系起来。这有助于建立涉及晶粒拓扑的结构-性能或加工-结构关系。

该脚本有助于对晶粒连通性模式进行比较分析，这是理解微观结构拓扑如何变化并可能影响材料行为的关键一步。
