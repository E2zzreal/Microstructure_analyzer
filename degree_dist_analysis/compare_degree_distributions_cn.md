# `compare_degree_distributions.py` 中文文档

## 目的

该脚本用于比较多个样本或预定义样本组之间的晶粒度分布。它读取多个样本的每个晶粒的详细信息文件 (`_details.csv`)，提取指定的度特征（例如 `neighbor_count`, `delaunay_degree_adaptive_1r1std`），并生成图表（如 KDE 图、箱线图、小提琴图或分面直方图）以直观地比较这些分布。

这对于识别不同实验条件、材料批次或性能组之间晶粒连通性模式的系统性差异非常有用。

## 先决条件

*   多个 `_details.csv` 文件，每个待比较的样本一个，位于指定的文件夹内。这些文件必须包含用于比较的度特征列。它们由 `run_feature_extraction.py` 使用 `--save_grain_details` 标志生成。

## 使用方法

```bash
python compare_degree_distributions.py --details_folder <包含详细数据文件的文件夹路径> \
                                       --output_path <比较图保存路径.png> \
                                       [--file_pattern <glob模式>] \
                                       [--degree_column <度特征列名>] \
                                       [--plot_type <类型>] \
                                       [--labels <标签1> <标签2> ...]
```

## 参数说明

*   `--details_folder` (必需): 包含待比较样本的 `_details.csv` 文件的目录路径。
*   `--output_path` (必需): 输出比较图图像（例如 `.png`）的保存路径。
*   `--file_pattern` (可选): 用于在 `--details_folder` 中查找相关 `_details.csv` 文件的 glob 模式。默认值：`'*_details.csv'`。
*   `--degree_column` (可选): `_details.csv` 文件中包含要比较的度数据的列名。默认值：`'neighbor_count'`。
*   `--plot_type` (可选): 用于比较的图表类型。可选值：
    *   `'kde'` (默认): 核密度估计图，叠加显示以供比较。通过平滑数据展示分布形状和峰值，适合比较不同组的整体分布形态和峰位差异。关键信息：峰值位置(众数)、峰的数量(模态)、分布宽度(离散度)、不同度数值下组间的相对密度。
    *   `'box'`: 每个样本/组的箱线图，显示中位数、四分位数和潜在异常值。箱体显示第25-75百分位数，中线为中位数，须线延伸至1.5倍IQR范围内的极值，之外的点为异常值。适合快速比较各组的中心趋势(中位数)和离散程度(四分位距IQR)。关键信息：中位数位置、IQR大小、异常值分布。
    *   `'violin'`: 小提琴图，结合了箱线图和KDE图的特点。宽度表示数据密度，内部通常包含箱线图元素。适合同时比较分布形状、密度和中心趋势。关键信息：结合了箱线图和KDE图的所有关键信息，特别适合展示多模态分布。
    *   `'hist'`: 分面直方图，将数据范围划分为区间(bins)并显示每个区间内的频数，每个组别在单独的面板中展示。适合详细比较特定度数范围内的频率差异。关键信息：各区间内的频数、整体分布形状(离散形式)、识别数据缺口或特定值簇。
*   `--labels` (可选): 为找到的每个样本/文件分配的自定义标签列表（按文件被找到的顺序，通常是字母顺序）。如果未提供，则从文件名的开头（第一个下划线之前）自动生成标签。

## 输出

*   一个图像文件（例如 `.png`），保存在指定的 `--output_path`。该图表直观地比较了分析中包含的不同样本之间所选度特征的分布。

## 解读与材料学意义

*   **分布比较 (KDE/Hist)**: 比较样本/组之间分布的形状、峰值位置和宽度。某个组是否始终显示出更高的平均度数？某个组的分布是更宽还是更窄？是否存在多个峰值，表明存在不同的晶粒连通性群体？
*   **集中趋势与离散度 (Box/Violin)**: 比较各组之间的中位度数（箱线图的中线）、四分位距（箱体高度）和整体范围（须）。在典型连通性或连通性变异性方面是否存在显著差异？
*   **统计显著性**: 虽然此脚本提供可视化比较，但观察到的差异可能需要进行正式的统计检验（例如，对按样本分组的度数据进行 t 检验、ANOVA 或 Kruskal-Wallis 检验）以确认其显著性（如果需要）。
*   **与性能/条件的联系**: 将观察到的度分布差异与样本/组相关的已知材料性能（例如 Hc20）或加工条件的差异联系起来。这有助于建立涉及晶粒拓扑的结构-性能或加工-结构关系。

该脚本有助于对晶粒连通性模式进行比较分析，这是理解微观结构拓扑如何变化并可能影响材料行为的关键一步。

## 图表类型详解

### 核密度估计图 (KDE)
- **原理**: 通过平滑数据展示分布形状和峰值
- **解读要点**: 
  - 峰值位置(众数)反映最常出现的度数
  - 峰的数量(模态)指示是否存在多个不同的晶粒连通性群体
  - 分布宽度反映离散程度
  - 不同组间的曲线重叠程度显示相似性
- **适用场景**: 比较整体分布形态和峰位差异

### 箱线图 (Box Plot)
- **原理**: 显示中位数、四分位数和潜在异常值
- **解读要点**:
  - 箱体显示第25-75百分位数(IQR)
  - 中线为中位数
  - 须线延伸至1.5倍IQR范围内的极值
  - 之外的点为异常值
- **适用场景**: 快速比较各组的中心趋势和离散程度

### 小提琴图 (Violin Plot)
- **原理**: 结合箱线图和KDE图的特点
- **解读要点**:
  - 宽度表示数据密度
  - 内部通常包含箱线图元素
  - 特别适合展示多模态分布
- **适用场景**: 同时比较分布形状、密度和中心趋势

### 分面直方图 (Faceted Histogram)
- **原理**: 将数据划分为区间(bins)并显示频数
- **解读要点**:
  - 各区间内的频数
  - 整体分布形状(离散形式)
  - 识别数据缺口或特定值簇
- **适用场景**: 详细比较特定度数范围内的频率差异
